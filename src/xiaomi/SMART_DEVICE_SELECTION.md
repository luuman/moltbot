# æ™ºèƒ½è®¾å¤‡é€‰æ‹© - æ— éœ€è®°å¿†DID

## ğŸ¯ é—®é¢˜

ç”¨æˆ·ä¸åº”è¯¥éœ€è¦çŸ¥é“å’Œè®°ä½è®¾å¤‡çš„DIDï¼ˆè®¾å¤‡IDï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯ç»†èŠ‚ã€‚

**ä¹‹å‰**:
```bash
# å¿…é¡»çŸ¥é“DID
xiaomi speak 289833424 "ä½ å¥½"
          â†‘ è¿™æ˜¯ä»€ä¹ˆï¼Ÿæ™®é€šç”¨æˆ·ä¸çŸ¥é“
```

**ç°åœ¨**:
```bash
# ç›´æ¥è¯´è¯ï¼Œè‡ªåŠ¨ä½¿ç”¨é»˜è®¤è®¾å¤‡
xiaomi speak "ä½ å¥½"

# æˆ–ä½¿ç”¨è®¾å¤‡åç§°
xiaomi speak "å°çˆ±éŸ³ç®±" "ä½ å¥½"
```

---

## âœ¨ æ–°åŠŸèƒ½

### 1ï¸âƒ£ è‡ªåŠ¨ä½¿ç”¨é»˜è®¤è®¾å¤‡

**æ— éœ€æŒ‡å®šè®¾å¤‡**ï¼Œè‡ªåŠ¨ä½¿ç”¨ç¬¬ä¸€ä¸ªåœ¨çº¿çš„å°çˆ±éŸ³ç®±ï¼š

```bash
# TTSæ’­æŠ¥
xiaomi speak "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”çœŸå¥½"

# è¯­éŸ³å‘½ä»¤
xiaomi command "ç°åœ¨å‡ ç‚¹äº†"

# é™é»˜å‘½ä»¤
xiaomi command-silent "æ’­æ”¾éŸ³ä¹"
```

**é»˜è®¤è®¾å¤‡é€‰æ‹©è§„åˆ™**:
1. ä¼˜å…ˆé€‰æ‹©**ç¬¬ä¸€ä¸ªåœ¨çº¿çš„**å°çˆ±éŸ³ç®±
2. å¦‚æœæ²¡æœ‰åœ¨çº¿è®¾å¤‡ï¼Œä½¿ç”¨**ç¬¬ä¸€ä¸ª**å°çˆ±éŸ³ç®±ï¼ˆå³ä½¿ç¦»çº¿ï¼‰
3. å¦‚æœæ²¡æœ‰ä»»ä½•å°çˆ±éŸ³ç®±ï¼ŒæŠ¥é”™æç¤º

---

### 2ï¸âƒ£ ä½¿ç”¨è®¾å¤‡åç§°

**æ”¯æŒæ¨¡ç³ŠåŒ¹é…**ï¼Œæ— éœ€è¾“å…¥å®Œæ•´åç§°ï¼š

```bash
# å®Œæ•´åç§°
xiaomi speak "å°çˆ±éŸ³ç®±Playï¼ˆ2019æ¬¾ï¼‰" "ä½ å¥½"

# éƒ¨åˆ†åŒ¹é…ï¼ˆæ¨èï¼‰
xiaomi speak "å°çˆ±éŸ³ç®±" "ä½ å¥½"
xiaomi speak "å°çˆ±" "ä½ å¥½"
xiaomi speak "Play" "ä½ å¥½"

# è¯­éŸ³å‘½ä»¤ä¹Ÿæ”¯æŒ
xiaomi command "å°çˆ±" "æ‰“å¼€å®¢å…ç¯"
```

**åŒ¹é…è§„åˆ™**:
- ä¸åŒºåˆ†å¤§å°å†™
- æ”¯æŒéƒ¨åˆ†åŒ¹é…ï¼ˆåŒ…å«å³å¯ï¼‰
- ä¾‹å¦‚: "å°çˆ±" å¯ä»¥åŒ¹é… "å°çˆ±éŸ³ç®±Playï¼ˆ2019æ¬¾ï¼‰"

---

### 3ï¸âƒ£ ç»§ç»­æ”¯æŒDIDï¼ˆå‘åå…¼å®¹ï¼‰

**ä¼ ç»Ÿæ–¹å¼ä»ç„¶æœ‰æ•ˆ**ï¼š

```bash
# ä½¿ç”¨DID
xiaomi speak 289833424 "ä½ å¥½"

# è¯­éŸ³å‘½ä»¤
xiaomi command 289833424 "ç°åœ¨å‡ ç‚¹äº†"
```

---

## ğŸ“– å®Œæ•´ç”¨æ³•

### TTS æ’­æŠ¥

```bash
# æ–¹å¼1: é»˜è®¤è®¾å¤‡
xiaomi speak "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”çœŸå¥½"

# æ–¹å¼2: è®¾å¤‡åç§°
xiaomi speak "å°çˆ±éŸ³ç®±" "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”çœŸå¥½"

# æ–¹å¼3: DID
xiaomi speak 289833424 "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”çœŸå¥½"
```

### è¯­éŸ³å‘½ä»¤

```bash
# æ–¹å¼1: é»˜è®¤è®¾å¤‡
xiaomi command "ç°åœ¨å‡ ç‚¹äº†"

# æ–¹å¼2: è®¾å¤‡åç§°
xiaomi command "å°çˆ±" "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"

# æ–¹å¼3: DID
xiaomi command 289833424 "æ’­æ”¾å‘¨æ°ä¼¦çš„æ­Œ"
```

### é™é»˜å‘½ä»¤

```bash
# æ–¹å¼1: é»˜è®¤è®¾å¤‡
xiaomi command-silent "æ‰“å¼€å®¢å…ç¯"

# æ–¹å¼2: è®¾å¤‡åç§°
xiaomi command-silent "Play" "å…³é—­å§å®¤ç¯"

# æ–¹å¼3: DID
xiaomi command-silent 289833424 "æ’­æ”¾éŸ³ä¹"
```

---

## ğŸ” æŸ¥çœ‹å¯ç”¨è®¾å¤‡

### åˆ—å‡ºæ‰€æœ‰å°çˆ±éŸ³ç®±

```bash
xiaomi speakers
```

è¾“å‡º:
```
æ‰¾åˆ° 1 ä¸ªå°çˆ±éŸ³ç®±:

  ğŸŸ¢ å°çˆ±éŸ³ç®±Playï¼ˆ2019æ¬¾ï¼‰
     å‹å·: xiaomi.wifispeaker.lx05
     DID: 289833424
```

ä»è¾“å‡ºä¸­ä½ å¯ä»¥ï¼š
- çœ‹åˆ°è®¾å¤‡åç§°ï¼ˆç”¨äºåç§°åŒ¹é…ï¼‰
- çœ‹åˆ°DIDï¼ˆå¦‚æœéœ€è¦ç²¾ç¡®æ§åˆ¶ï¼‰
- çœ‹åˆ°åœ¨çº¿çŠ¶æ€ï¼ˆğŸŸ¢åœ¨çº¿ ğŸ”´ç¦»çº¿ï¼‰

---

## ğŸ’¡ æ¨èä½¿ç”¨æ–¹å¼

### æƒ…å†µ1: åªæœ‰ä¸€ä¸ªå°çˆ±éŸ³ç®±

**æ¨è**: çœç•¥è®¾å¤‡å‚æ•°

```bash
xiaomi speak "ä½ å¥½"
xiaomi command "ç°åœ¨å‡ ç‚¹äº†"
```

### æƒ…å†µ2: æœ‰å¤šä¸ªå°çˆ±éŸ³ç®±

**æ¨è**: ä½¿ç”¨è®¾å¤‡åç§°

```bash
# ç»™å®¢å…çš„å°çˆ±è¯´è¯
xiaomi speak "å®¢å…" "å®¢å…ç¯å·²æ‰“å¼€"

# ç»™å§å®¤çš„å°çˆ±è¯´è¯
xiaomi speak "å§å®¤" "è¯¥ç¡è§‰äº†"
```

### æƒ…å†µ3: éœ€è¦ç²¾ç¡®æ§åˆ¶

**ä½¿ç”¨**: DID

```bash
xiaomi speak 289833424 "ä½ å¥½"
```

---

## ğŸ›  æŠ€æœ¯å®ç°

### æ™ºèƒ½è®¾å¤‡æŸ¥æ‰¾

```typescript
// src/xiaomi/client.ts

/**
 * é€šè¿‡åç§°æˆ–DIDæŸ¥æ‰¾è®¾å¤‡ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
 */
findDevice(nameOrDid: string): DeviceInfo | undefined {
  // 1. ç²¾ç¡®DIDåŒ¹é…
  if (this.devices[nameOrDid]) {
    return this.devices[nameOrDid];
  }

  // 2. åç§°æ¨¡ç³ŠåŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
  const lowerQuery = nameOrDid.toLowerCase();
  for (const device of Object.values(this.devices)) {
    if (device.name.toLowerCase().includes(lowerQuery)) {
      return device;
    }
  }

  return undefined;
}
```

### é»˜è®¤è®¾å¤‡é€‰æ‹©

```typescript
/**
 * è·å–é»˜è®¤å°çˆ±éŸ³ç®±ï¼ˆç¬¬ä¸€ä¸ªåœ¨çº¿çš„ï¼‰
 */
getDefaultXiaoAISpeaker(): DeviceInfo | undefined {
  const speakers = this.getXiaoAISpeakers();

  // ä¼˜å…ˆè¿”å›åœ¨çº¿è®¾å¤‡
  const onlineSpeaker = speakers.find(s => s.online);
  if (onlineSpeaker) {
    return onlineSpeaker;
  }

  // æ²¡æœ‰åœ¨çº¿è®¾å¤‡ï¼Œè¿”å›ç¬¬ä¸€ä¸ª
  return speakers[0];
}
```

### æ™ºèƒ½åˆ›å»ºæ§åˆ¶å™¨

```typescript
/**
 * æ™ºèƒ½åˆ›å»ºå°çˆ±éŸ³ç®±æ§åˆ¶å™¨
 * - å¯ä»¥ä¼ å…¥è®¾å¤‡åç§°ã€DIDï¼Œæˆ–ç•™ç©ºä½¿ç”¨é»˜è®¤è®¾å¤‡
 */
createXiaoAISpeakerSmart(nameOrDid?: string): XiaoAISpeaker {
  let device: DeviceInfo | undefined;

  if (nameOrDid) {
    // æŸ¥æ‰¾æŒ‡å®šè®¾å¤‡
    device = this.findDevice(nameOrDid);
    if (!device) {
      throw new Error(`Device "${nameOrDid}" not found`);
    }
  } else {
    // ä½¿ç”¨é»˜è®¤è®¾å¤‡
    device = this.getDefaultXiaoAISpeaker();
    if (!device) {
      throw new Error('No XiaoAI speaker found');
    }
  }

  return createXiaoAISpeaker(this.httpClient, device);
}
```

### CLIå‚æ•°è§£æ

```typescript
async function cmdSpeak(deviceOrText: string, maybeText?: string) {
  let device: string | undefined;
  let text: string;

  // æ™ºèƒ½è§£æå‚æ•°
  if (maybeText) {
    // ä¸¤ä¸ªå‚æ•°: "è®¾å¤‡ æ–‡æœ¬"
    device = deviceOrText;
    text = maybeText;
  } else {
    // ä¸€ä¸ªå‚æ•°: "æ–‡æœ¬"
    device = undefined;
    text = deviceOrText;
  }

  // ä½¿ç”¨æ™ºèƒ½åˆ›å»ºæ–¹æ³•
  const xiaoai = client.createXiaoAISpeakerSmart(device);
  await xiaoai.speak(text);
}
```

---

## ğŸ“Š ä½¿ç”¨ç»Ÿè®¡ï¼ˆç¤ºä¾‹ï¼‰

å‡è®¾ä½ æœ‰ä»¥ä¸‹è®¾å¤‡ï¼š
```
å°çˆ±éŸ³ç®±Playï¼ˆ2019æ¬¾ï¼‰ - DID: 289833424 - ğŸŸ¢åœ¨çº¿
å°çˆ±éŸ³ç®±Pro           - DID: 123456789 - ğŸ”´ç¦»çº¿
```

### å„ç§è°ƒç”¨æ–¹å¼çš„ç»“æœ

| å‘½ä»¤ | ä½¿ç”¨çš„è®¾å¤‡ | è¯´æ˜ |
|------|----------|------|
| `xiaomi speak "ä½ å¥½"` | å°çˆ±éŸ³ç®±Play | é»˜è®¤ï¼ˆç¬¬ä¸€ä¸ªåœ¨çº¿ï¼‰ |
| `xiaomi speak "Play" "ä½ å¥½"` | å°çˆ±éŸ³ç®±Play | åç§°åŒ¹é… |
| `xiaomi speak "Pro" "ä½ å¥½"` | å°çˆ±éŸ³ç®±Pro | åç§°åŒ¹é…ï¼ˆå³ä½¿ç¦»çº¿ï¼‰ |
| `xiaomi speak 289833424 "ä½ å¥½"` | å°çˆ±éŸ³ç®±Play | DIDç²¾ç¡®åŒ¹é… |
| `xiaomi speak "éŸ³ç®±" "ä½ å¥½"` | å°çˆ±éŸ³ç®±Play | åç§°åŒ…å«"éŸ³ç®±"ï¼ˆç¬¬ä¸€ä¸ªåŒ¹é…ï¼‰ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è®¾å¤‡åç§°é‡å¤

å¦‚æœå¤šä¸ªè®¾å¤‡åç§°ç›¸ä¼¼ï¼š
```
å®¢å…å°çˆ±éŸ³ç®±
å§å®¤å°çˆ±éŸ³ç®±
```

ä½¿ç”¨ "å°çˆ±" ä¼šåŒ¹é…åˆ°**ç¬¬ä¸€ä¸ª**åŒ…å«"å°çˆ±"çš„è®¾å¤‡ã€‚

**è§£å†³æ–¹æ³•**:
- ä½¿ç”¨æ›´å…·ä½“çš„åç§°éƒ¨åˆ†ï¼š`xiaomi speak "å®¢å…" "..."`
- æˆ–ä½¿ç”¨DIDç²¾ç¡®æ§åˆ¶

### 2. è®¾å¤‡ç¦»çº¿

ä½¿ç”¨è®¾å¤‡åç§°æˆ–DIDæŒ‡å®šç¦»çº¿è®¾å¤‡æ—¶ï¼š
- å‘½ä»¤ä¼šå‘é€ï¼Œä½†è®¾å¤‡å¯èƒ½æ— æ³•æ‰§è¡Œ
- å»ºè®®ä½¿ç”¨ `xiaomi speakers` æŸ¥çœ‹è®¾å¤‡åœ¨çº¿çŠ¶æ€

### 3. æ²¡æœ‰å°çˆ±éŸ³ç®±

å¦‚æœè´¦å·ä¸‹æ²¡æœ‰å°çˆ±éŸ³ç®±ï¼š
```bash
xiaomi speak "ä½ å¥½"
# é”™è¯¯: No XiaoAI speaker found. Please add a XiaoAI speaker first.
```

---

## ğŸ‰ ä½“éªŒæ”¹è¿›å¯¹æ¯”

### ä¹‹å‰ï¼ˆå¿…é¡»è®°ä½DIDï¼‰

```bash
# 1. æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨
xiaomi speakers

æ‰¾åˆ° 1 ä¸ªå°çˆ±éŸ³ç®±:
  ğŸŸ¢ å°çˆ±éŸ³ç®±Playï¼ˆ2019æ¬¾ï¼‰
     DID: 289833424        â† è®°ä¸‹è¿™ä¸ªæ•°å­—

# 2. ä½¿ç”¨ï¼ˆå¿…é¡»è¾“å…¥DIDï¼‰
xiaomi speak 289833424 "ä½ å¥½"
          â†‘ å¿…é¡»æ‰‹åŠ¨è¾“å…¥ï¼Œå®¹æ˜“å‡ºé”™
```

### ç°åœ¨ï¼ˆæ— éœ€è®°å¿†ï¼‰

```bash
# ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€æŸ¥çœ‹DID
xiaomi speak "ä½ å¥½"
# æˆ–
xiaomi speak "å°çˆ±" "ä½ å¥½"

# ç®€å•ã€ç›´è§‚ã€ä¸æ˜“å‡ºé”™
```

---

## æ€»ç»“

**æ”¹è¿›å‰**:
- âŒ å¿…é¡»çŸ¥é“DID
- âŒ å¿…é¡»æ¯æ¬¡æŸ¥çœ‹è®¾å¤‡åˆ—è¡¨
- âŒ è¾“å…¥é•¿æ•°å­—å®¹æ˜“å‡ºé”™

**æ”¹è¿›å**:
- âœ… é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªåœ¨çº¿è®¾å¤‡
- âœ… æ”¯æŒè®¾å¤‡åç§°ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
- âœ… ä»æ”¯æŒDIDï¼ˆå‘åå…¼å®¹ï¼‰
- âœ… æ›´åŠ ç”¨æˆ·å‹å¥½

**æ¨èä½¿ç”¨**:
```bash
# æœ€ç®€å•ï¼ˆæ¨èï¼‰
xiaomi speak "ä½ å¥½"

# æŒ‡å®šè®¾å¤‡ï¼ˆå¤šè®¾å¤‡åœºæ™¯ï¼‰
xiaomi speak "å®¢å…" "ä½ å¥½"

# ç²¾ç¡®æ§åˆ¶ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰
xiaomi speak 289833424 "ä½ å¥½"
```

ğŸ¯ **ç›®æ ‡è¾¾æˆ**: æ™®é€šç”¨æˆ·æ— éœ€äº†è§£DIDç­‰æŠ€æœ¯ç»†èŠ‚ï¼Œå³å¯è½»æ¾ä½¿ç”¨ï¼
